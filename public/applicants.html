<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Applicants</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .scrollable-table {
            height: 400px;
            overflow-y: auto;
            display: block;
        }
        #noDataMessage {
            display: none;
            font-size: 18px;
            color: red;
        }
        .toast {
            position: fixed;
            top: 0px; /* Position it at the top */
            /* left: 50%; Center horizontally */
            /* transform: translateX(-50%); Adjust for centering */
            background-color: #f44336; /* Red */
            color: white;
            padding: 16px;
            border-radius: 5px;
            z-index: 1000;
        }

    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-primary d-flex">
        <div>
            <a class="navbar-brand text-light" href="#" style="font-weight: bold;">Admin</a>
        </div>
        
      
        <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
          <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
            <li class="nav-item active">
              <a class="nav-link text-light" style="font-weight: bold;" href="/applicants-page">Applicants</a>
            <li class="nav-item active">
                <a class="nav-link text-light" href="/expiry-user"  style="font-weight: bold;">Expiry Applicants <span class="sr-only">(current)</span></a>
            </li>

            
           
          </ul>
         
          <!-- <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
          </form> -->
        </div>
        <div>
            <ul class="navbar-nav mt-2 mt-lg-0 text-primary" >
                <li class="nav-item active" >
                    <a class="nav-link text-light" onclick="logout()" style="cursor: pointer;font-weight: bold;">logout</a>
                </li>
              </ul>
        </div>
        <div>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02" aria-controls="navbarTogglerDemo02" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
        </div>
      </nav>
      <section>
        <br>
    <h1>Applicants</h1>
    <div id="noDataMessage">No data is present</div>

    <div class="scrollable-table">
        <table id="applicantsTable">
            <thead>
                <tr>
                    <th>Application No</th>
                    <th>Application Date</th>
                    <th>Name</th>
                    <th>Gender</th>
                    <th>Email</th>
                    <th>Date of Birth</th>
                    <th>Phone Number</th>
                    <th>From Date</th>
                    <th>Expiry Date</th>
                    <th>Whatsapp Number</th>
                    <th>Pan Card Number</th>
                    <th>Aadhaar Number</th>
                    <th>Current Address</th>
                    <th>Same Address</th>
                    <th>Permanent Address</th>
                    <th>Pin Code</th>
                    <th>City</th>
                    <th>State</th>
                    <th>Country</th>
                    <th>Landmark</th>
                    <th>Foreign National</th>
                    <th>PEP Status</th>
                    <th>Bank Name</th>
                    <th>Account Number</th>
                    <th>MICR</th>
                    <th>IFSC Code</th>
                    <th>Account Type</th>
                    <th>Branch Address</th>
                    <th>Nominee Name</th>
                    <th>Nominee DOB</th>
                    <th>Nominee Gender</th>
                    <th>Nominee Relationship</th>
                    <th>Nominee Phone Number</th>
                    <th>Appointee Name</th>
                    <th>Appointee Relationship</th>
                    <th>Payment Mode</th>
                    <th>Plan Selection</th>
                    <th>Subscription Option</th>
                    <th>Payor Name</th>
                    <th>Payor Relation</th>
                    <th>Payor Phone</th>
                    <th>Payor Email</th>
                    <th>Opt Option</th>
                    <th>With Name</th>
                    <th>With Relationship</th>
                    <th>With Address</th>
                    <th>With City</th>
                    <th>With State</th>
                    <th>With Country</th>
                    <th>With Pincode</th>
                    <th>With Landmark</th>
                    <th>Terms Accepted</th>
                </tr>
            </thead>
            <tbody>
                <!-- Table rows will be inserted here dynamically -->
            </tbody>
        </table>
    </div>
    <br>
    <button onclick="downloadExcel()">Download Excel</button>
</section>


    <script>
        // Function to show toast notification
function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    document.body.appendChild(toast);
    
    // Remove the toast after 3 seconds
    setTimeout(() => {
        toast.remove();
    }, 3000);
}
function logout() {
    fetch('/logout', {
        method: 'POST',
        credentials: 'include' // Include cookies for session
    })
    .then(response => {
        if (response.ok) {
            showToast('logout successfully');
            window.location.href = '/login'; // Redirect to the login page
        }
    })
    .catch(error => console.error('Error logging out:', error));
}


// Fetch applicants data
fetch('/applicants')
    .then(response => {
        if (response.status === 403) {
            showToast('You are not authorized, please login first.');
            window.location.href = '/login'; // Redirect to login
            return;
        }
        return response.json();
    })
    .then(data => {
        const tableBody = document.querySelector('#applicantsTable tbody');
        const noDataMessage = document.getElementById('noDataMessage');

        // Clear previous data
        tableBody.innerHTML = '';

        if (data.length === 0) {
            noDataMessage.style.display = 'block'; // Show the no data message
        } else {
            noDataMessage.style.display = 'none'; // Hide no data message
            data.forEach(applicant => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${applicant.appl_no}</td>
                    <td>${applicant.appl_date}</td>
                    <td>${applicant.name}</td>
                    <td>${applicant.gender}</td>
                    <td>${applicant.email}</td>
                    <td>${applicant.dateOfBirth}</td>
                    <td>${applicant.phoneNumber}</td>
                    <td>${applicant.from_date}</td>
                    <td>${applicant.expiry_date}</td>
                    <td>${applicant.whatsappNumber}</td>
                    <td>${applicant.panCardNumber}</td>
                    <td>${applicant.aadhaarNumber}</td>
                    <td>${applicant.currentAddress}</td>
                    <td>${applicant.sameAddress}</td>
                    <td>${applicant.permanentAddress}</td>
                    <td>${applicant.pinCode}</td>
                    <td>${applicant.city}</td>
                    <td>${applicant.state}</td>
                    <td>${applicant.country}</td>
                    <td>${applicant.landmark}</td>
                    <td>${applicant.foreignNational}</td>
                    <td>${applicant.pepStatus}</td>
                    <td>${applicant.bankName}</td>
                    <td>${applicant.accountNumber}</td>
                    <td>${applicant.MICR}</td>
                    <td>${applicant.ifscCode}</td>
                    <td>${applicant.accountType}</td>
                    <td>${applicant.branchAddress}</td>
                    <td>${applicant.nomineeName}</td>
                    <td>${applicant.nomineeDOB}</td>
                    <td>${applicant.nomineeGender}</td>
                    <td>${applicant.nomineeRelationship}</td>
                    <td>${applicant.nomineePhoneNumber}</td>
                    <td>${applicant.appointeeName}</td>
                    <td>${applicant.appointeeRelationship}</td>
                    <td>${applicant.paymentMode}</td>
                    <td>${applicant.planSelection}</td>
                    <td>${applicant.subscriptionOption}</td>
                    <td>${applicant.payor_name}</td>
                    <td>${applicant.payor_relation}</td>
                    <td>${applicant.payor_phone}</td>
                    <td>${applicant.payor_email}</td>
                    <td>${applicant.opt_option}</td>
                    <td>${applicant.with_name}</td>
                    <td>${applicant.with_relationship}</td>
                    <td>${applicant.with_address}</td>
                    <td>${applicant.with_city}</td>
                    <td>${applicant.with_state}</td>
                    <td>${applicant.with_country}</td>
                    <td>${applicant.with_pincode}</td>
                    <td>${applicant.with_landmark}</td>
                    <td>${applicant.terms_accepted}</td>
                `;
                tableBody.appendChild(row);
            });
        }
    })
    .catch(err => console.error(err));

        function downloadExcel() {
            window.location.href = '/download-excel';
        }

fetch('/expiry-user')
    .then(response => response.json())
    .then(data => {
        const tableBody = document.querySelector('#expiryUsersTable tbody');
        const noDataMessage = document.getElementById('noExpiryUsersMessage');

        // Clear previous data
        tableBody.innerHTML = '';

        if (data.length === 0) {
            noDataMessage.style.display = 'block'; // Show the no data message
        } else {
            noDataMessage.style.display = 'none'; // Hide no data message
            data.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.expiry_date}</td>
                `;
                tableBody.appendChild(row);
            });
        }
    })
    .catch(err => console.error(err));
    </script>
</body>
</html>
